const BaseComponent=Formio.Components.components.panel;class CameraOrientationComponent extends BaseComponent{static schema(...e){try{return BaseComponent.schema({label:"Camera Orientation",type:"cameraorientation",key:"cameraorientation",title:"Camera Orientation",theme:"default",breadcrumb:"default",components:[{label:"Upload",hideLabel:!0,tableView:!1,storage:"url",image:!0,webcam:!0,capture:!1,fileTypes:[{label:"",value:""}],key:"file",type:"file",input:!0,url:"/sharefiles/xportal"},{label:"Columns",columns:[{components:[{label:"Latitude",applyMaskOn:"change",tableView:!0,key:"latitude",type:"textfield",input:!0,disabled:!0},{label:"Longitude",applyMaskOn:"change",tableView:!0,key:"longitude",type:"textfield",input:!0,disabled:!0},{label:"Orientation",applyMaskOn:"change",tableView:!0,key:"orientation",type:"textfield",input:!0,disabled:!0}],width:6,offset:0,push:0,pull:0,size:"md",currentWidth:6},{components:[{label:"Latitude",applyMaskOn:"change",disabled:!0,tableView:!0,key:"latitudeCapture",type:"textfield",input:!0},{label:"Longitude",applyMaskOn:"change",disabled:!0,tableView:!0,key:"longitudeCapture",type:"textfield",input:!0},{label:"Orientation",applyMaskOn:"change",disabled:!0,tableView:!0,key:"orientationCapture",type:"textfield",input:!0}],width:6,offset:0,push:0,pull:0,size:"md",currentWidth:6}],hidden:!1,key:"columns",type:"columns",input:!0,tableView:!1}],clearOnHide:!1,input:!0,tag:"single",validateOn:"change",persistence:!0,multiple:!0,validate:{required:!0}})}catch(e){console.error(e)}}static get builderInfo(){try{return{title:"Camera Orientation",icon:"fa-camera",group:"basic",documentation:"/userguide/#textfield",weight:0,schema:CameraOrientationComponent.schema()}}catch(e){console.error(e)}}constructor(e,t,n){console.log("i m in constructor"),super(e,t,n)}init(){try{console.log("Init camera orientation"),this.componentKeysMap={},this.intervall,super.init()}catch(e){console.error(e)}}get BaseComponentInfo(){try{return super.BaseComponentInfo}catch(e){console.error(e)}}async attach(e){console.log("Attached",e);try{this.loadRefs(e,{customRef:"single"}),this.#e(),console.log("mon objet refs",this.refs);const n=await super.attach(e);console.log("mes composants",this.components);this.components;const o=this.getComponent(this.componentKeysMap.file);if(console.log("text fileComponent",o),o){console.log("orientation obtention position",this.getCurrentUserLatLng()),o.refs.fileBrowse.style.display="none";var t=o.refs.fileBrowse.parentNode;let e=o.refs.toggleCameraMode.nextSibling,n=o.refs.toggleCameraMode.previousSibling;document.querySelector('button[ref="toggleCameraMode"]');t.firstChild.parentElement.children[0].style.display="none",t.removeChild(n),t.removeChild(e);const a=o.refs.takePictureButton;a?this.addEventListener(a,"click",(e=>{console.log("Take picture is ................",e)})):console.log("Take picture button is unavailable")}return this.#t(),e.removeEventListener("click",this.#n.bind(this)),e.removeEventListener("click",this.#o.bind(this)),e.addEventListener("click",this.#n.bind(this)),e.addEventListener("click",this.#o.bind(this)),Promise.resolve(n)}catch(e){throw e}}detach(){try{return super.detach()}catch(e){console.error(e)}}destroy(){return clearInterval(this.intervall),super.destroy()}normalizeValue(e,t={}){try{return super.normalizeValue(e,t)}catch(e){console.error(e)}}getValue(){try{return this.markers}catch(e){console.error(e)}}getValueAt(e){return super.getValueAt(e)}setValue(e,t={}){return super.setValue(e,t)}setValueAt(e,t,n={}){return super.setValueAt(e,t,n)}updateValue(e,t={}){return super.updateValue(...arguments)}#a(){this.realTimePositionClockRef=setInterval(this.getCurrentUserLatLng.bind(this),2e3)}getCurrentUserLatLng(){try{navigator.geolocation?navigator.geolocation.getCurrentPosition(this.#i.bind(this),this.#r.bind(this)):console.log("La geolocalisation n'est pas supportee")}catch(e){console.error(e)}}#e(){var e=this.components,t=e[0].component;this.componentKeysMap.file=t.key;var n=e[1].components,o=n[0].component;this.componentKeysMap.latitude=o.key;var a=n[1].component;this.componentKeysMap.longitude=a.key;var i=n[2].component;this.componentKeysMap.orientation=i.key;var r=n[3].component;this.componentKeysMap.latitudeCapture=r.key;var s=n[4].component;this.componentKeysMap.longitudeCapture=s.key;var l=n[5].component;this.componentKeysMap.orientationCapture=l.key}#i(e){let t=e?.coords?.longitude,n=e?.coords?.latitude;this.#s(n),this.#l(t)}#r(e){console.error(e)}#s(e){const t=this.getComponent(this.componentKeysMap.latitude);t&&(t.dataValue=`${e}`)}#p(e){const t=this.getComponent(this.componentKeysMap.latitudeCapture);console.log("ma valeur capture",t),t&&(t.dataValue=`${e}`)}#l(e){const t=this.getComponent(this.componentKeysMap.longitude);t&&(t.dataValue=`${e}`)}#c(e){const t=this.getComponent(this.componentKeysMap.longitudeCapture);t&&(t.dataValue=`${e}`)}#u(e){const t=this.getComponent(this.componentKeysMap.orientation);t&&(t.dataValue=`${e}`)}#m(e){const t=this.getComponent(this.componentKeysMap.orientationCapture);t&&(t.dataValue=`${e}`)}#t(){navigator.userAgent.match(/(iPod|iPhone|iPad)/)&&navigator.userAgent.match(/AppleWebKit/)?DeviceOrientationEvent.requestPermission().then((e=>{"granted"===e?window.addEventListener("deviceorientation",this.#d.bind(this),!0):alert("has to be allowed!")})).catch((()=>alert("not supported"))):window.addEventListener("deviceorientationabsolute",this.#d.bind(this),!0)}#d(e){let t=e.webkitCompassHeading||Math.abs(e.alpha-360)*Math.PI/180;console.log(t),this.#u(t)}#n(e){e.target.innerHTML.trim().toLowerCase();"take picture"==e.target.innerText.trim().toLowerCase()&&(this.#p(this.getComponent(this.componentKeysMap.latitude).dataValue),this.#c(this.getComponent(this.componentKeysMap.longitude).dataValue),this.#m(this.getComponent(this.componentKeysMap.orientation).dataValue),this.intervall=setInterval((()=>{this.#h()}),1e3),this.triggerRedraw())}#h(){const e=this.getComponent(this.componentKeysMap.file);if(e){if(e.refs.fileDrop&&e.refs.fileBrowse){e.refs.fileBrowse.style.display="none";var t=e.refs.fileBrowse.parentNode}if(t){let n=e.refs.toggleCameraMode.nextSibling,o=e.refs.toggleCameraMode.previousSibling;document.querySelector('button[ref="toggleCameraMode"]');t.firstChild.parentElement.children[0].style.display="none",t.removeChild(o),t.removeChild(n)}}}#o(e){e.target.innerHTML.trim().toLowerCase();"switch to file upload"==e.target.innerText.trim().toLowerCase()&&this.#h()}}CameraOrientationComponent.editForm=(...e)=>{try{return BaseComponent.editForm(...e)}catch(e){console.error(e)}},Formio.Components.addComponent("cameraorientation",CameraOrientationComponent);